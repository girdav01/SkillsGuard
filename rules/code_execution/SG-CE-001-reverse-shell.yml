id: SG-CE-001
name: Reverse Shell Detection
description: >
  Detects reverse shell patterns in bundled scripts that could
  establish unauthorized remote access to the host system. Covers
  bash, Python, Perl, Ruby, PHP, and netcat reverse shells.
severity: critical
category: code_execution
owasp_llm: [LLM06]
mitre_attack: [T1059, T1071.001]
target: SCRIPT
engine: REGEX
pattern:
  any:
    - "(?i)bash\\s+-i\\s+>&\\s+/dev/tcp/"
    - "(?i)/dev/tcp/\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}/\\d+"
    - "(?i)(nc|ncat|netcat)\\s+(-e|-c|--exec|--sh-exec)\\s+(/bin/)?(sh|bash|cmd)"
    - "(?i)(nc|ncat|netcat)\\s+\\S+\\s+\\d+\\s+(-e|-c)\\s+"
    - "(?i)socket\\.socket\\s*\\(.*\\).*\\.connect\\s*\\(.*\\).*subprocess"
    - "(?i)import\\s+socket.*os\\.dup2.*os\\.exec"
    - "(?i)perl\\s+-e\\s+[\"'].*socket.*exec"
    - "(?i)ruby\\s+-rsocket\\s+-e\\s+[\"'].*TCPSocket"
    - "(?i)php\\s+-r\\s+[\"'].*fsockopen.*exec"
    - "(?i)python[23]?\\s+-c\\s+[\"'].*socket.*subprocess"
    - "(?i)mkfifo\\s+/tmp/\\w+\\s*;\\s*(nc|ncat|netcat)"
    - "(?i)socat\\s+.{0,30}(exec|system)\\s*:"
    - "(?i)msfvenom|meterpreter|metasploit|payload.*reverse"
    - "(?i)powershell\\s+.{0,50}(New-Object\\s+System\\.Net\\.Sockets\\.TCPClient|Invoke-PowerShellTcp)"
    - "(?i)\\$client\\s*=\\s*New-Object\\s+System\\.Net\\.Sockets\\.TCPClient"
remediation: >
  Remove any code that establishes outbound shell connections.
  If remote access is needed, use authenticated, audited channels
  with proper access controls.
references:
  - https://attack.mitre.org/techniques/T1059/
  - https://www.revshells.com/
