id: SG-CT-012
name: Kubernetes Secret Access
description: >
  Detects attempts to access Kubernetes secrets, service account
  tokens, and kubeconfig files. These contain authentication
  credentials for cluster access and may include certificates,
  tokens, and connection details for various services.
severity: critical
category: credential_theft
owasp_llm: [LLM06]
mitre_attack: [T1552.001, T1552.007]
target: ANY
engine: REGEX
pattern:
  any:
    - "(?i)kubectl\\s+get\\s+secret"
    - "(?i)kubectl\\s+describe\\s+secret"
    - "(?i)kubectl\\s+get\\s+secret\\s+.{0,30}-o\\s*(json|yaml|jsonpath)"
    - "(?i)(cat|read|open|get|less|type|head|tail|print)\\s+.{0,20}(~|\\.)/?\\.kube/config"
    - "(?i)(cp|copy|scp|rsync|send|upload|post|transmit)\\s+.{0,30}\\.kube/config"
    - "(?i)\\$\\{?(KUBECONFIG|KUBE_TOKEN|KUBE_CA_CERT|K8S_TOKEN|KUBERNETES_SERVICE_TOKEN)\\}?"
    - "(?i)(cat|read|open)\\s+.{0,20}/var/run/secrets/kubernetes\\.io/serviceaccount/token"
    - "(?i)(cat|read|open)\\s+.{0,20}/var/run/secrets/kubernetes\\.io/serviceaccount/ca\\.crt"
    - "(?i)(steal|extract|exfiltrate|harvest|grab|dump)\\s+.{0,20}(kubernetes|k8s|kube)\\s*(secret|credential|token|config)"
    - "(?i)kubectl\\s+exec\\s+.{0,30}(cat|read)\\s+.{0,20}secret"
false_positive_notes: >
  Kubernetes management skills may interact with secrets as part
  of legitimate cluster operations. Verify whether the skill
  manages secrets appropriately vs. extracting them.
remediation: >
  Use Kubernetes RBAC to restrict secret access. Prefer external
  secret management solutions (Vault, Sealed Secrets) over
  directly reading Kubernetes secrets.
references:
  - https://kubernetes.io/docs/concepts/configuration/secret/
  - https://attack.mitre.org/techniques/T1552/007/
