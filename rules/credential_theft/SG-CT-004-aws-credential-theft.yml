id: SG-CT-004
name: AWS Credential Theft
description: >
  Detects attempts to access AWS credentials from standard locations
  including ~/.aws/credentials, ~/.aws/config, environment variables,
  EC2 instance metadata, and ECS task credentials.
severity: critical
category: credential_theft
owasp_llm: [LLM06]
mitre_attack: [T1552.001, T1552.005]
target: ANY
engine: REGEX
pattern:
  any:
    - "(?i)(cat|read|open|get|less|more|type|head|tail|display|print)\\s+.{0,20}(\\.aws/(credentials|config)|~/.aws)"
    - "(?i)(cp|copy|mv|scp|rsync|send|upload|post|transmit)\\s+.{0,30}\\.aws/(credentials|config)"
    - "(?i)\\$\\{?(AWS_ACCESS_KEY_ID|AWS_SECRET_ACCESS_KEY|AWS_SESSION_TOKEN|AWS_SECURITY_TOKEN|AWS_DEFAULT_REGION)\\}?"
    - "(?i)curl\\s+.{0,30}169\\.254\\.169\\.254/(latest|meta-data)/(iam|credentials|identity)"
    - "(?i)curl\\s+.{0,30}169\\.254\\.170\\.2/credentials"
    - "(?i)(AKIA|ASIA)[A-Z0-9]{16}"
    - "(?i)aws_access_key_id\\s*=\\s*[A-Z0-9]{16,}"
    - "(?i)aws_secret_access_key\\s*=\\s*[A-Za-z0-9/+=]{30,}"
    - "(?i)(get|fetch|read|extract|steal|harvest)\\s+.{0,20}(aws|amazon)\\s*(credential|secret|key|token)"
    - "(?i)(ec2|ecs|lambda)\\s+(instance\\s+)?metadata\\s*.{0,20}(credential|role|token|key)"
false_positive_notes: >
  AWS management skills may legitimately reference credential
  configuration. Verify whether the skill configures new credentials
  vs. extracting existing ones.
remediation: >
  Remove direct AWS credential access patterns. Use IAM roles,
  instance profiles, or temporary credentials via STS instead of
  directly reading credential files.
references:
  - https://attack.mitre.org/techniques/T1552/005/
  - https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html
