id: SG-CT-010
name: NPM/PyPI Token Access
description: >
  Detects attempts to access package registry authentication tokens
  for NPM, PyPI, RubyGems, and other package managers. These tokens
  allow publishing packages and could be used for supply chain
  attacks if stolen.
severity: high
category: credential_theft
owasp_llm: [LLM06]
mitre_attack: [T1552.001, T1195.001]
target: ANY
engine: REGEX
pattern:
  any:
    - "(?i)(cat|read|open|get|less|type|head|tail|print)\\s+.{0,20}(\\.npmrc|~/.npmrc|/etc/npmrc)"
    - "(?i)(cat|read|open|get|less|type|head|tail|print)\\s+.{0,20}(\\.pypirc|~/.pypirc)"
    - "(?i)\\$\\{?(NPM_TOKEN|NPM_AUTH_TOKEN|NODE_AUTH_TOKEN|PYPI_TOKEN|PYPI_API_TOKEN|TWINE_PASSWORD|RUBYGEMS_API_KEY|GEM_HOST_API_KEY|CARGO_REGISTRY_TOKEN)\\}?"
    - "(?i)npm_[A-Za-z0-9]{36}"
    - "(?i)pypi-[A-Za-z0-9\\-_]{50,}"
    - "(?i)(//registry\\.npmjs\\.org/|_authToken|_auth)\\s*=\\s*[A-Za-z0-9\\-_.+/=]{10,}"
    - "(?i)(cat|read|open|get)\\s+.{0,20}(\\.gem/credentials|~/.gem/credentials)"
    - "(?i)(steal|extract|exfiltrate|harvest|grab|dump)\\s+.{0,20}(npm|pypi|gem|cargo|nuget)\\s*(token|credential|auth)"
    - "(?i)(send|post|upload|transmit|curl|wget)\\s+.{0,40}(npmrc|pypirc|npm[_-]?token|pypi[_-]?token)"
false_positive_notes: >
  Package management skills may reference registry configuration.
  Check if the skill configures authentication vs. stealing tokens.
remediation: >
  Remove references to reading package registry tokens. Use CI/CD
  secret injection or environment-scoped tokens with minimal
  permissions instead of accessing token files directly.
references:
  - https://docs.npmjs.com/using-private-packages-in-a-ci-cd-workflow
  - https://pypi.org/help/#apitoken
