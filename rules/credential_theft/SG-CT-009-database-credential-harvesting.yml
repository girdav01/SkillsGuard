id: SG-CT-009
name: Database Credential Harvesting
description: >
  Detects attempts to extract database connection strings, passwords,
  and credentials from configuration files, environment variables,
  and application code. Database credentials provide direct access
  to potentially sensitive data stores.
severity: critical
category: credential_theft
owasp_llm: [LLM06]
mitre_attack: [T1552.001]
target: ANY
engine: REGEX
pattern:
  any:
    - "(?i)(cat|read|open|get|grep|find)\\s+.{0,30}(database\\.yml|database\\.ini|database\\.conf|db\\.conf|db\\.ini)"
    - "(?i)(mysql|postgres|psql|mongo|redis|sqlite3|sqlplus)\\s+.{0,30}(-p\\s+|-P\\s+|--password[= ]|://\\w+:)[^\\s]+"
    - "(?i)(DATABASE_URL|DB_PASSWORD|DB_PASS|MYSQL_PASSWORD|POSTGRES_PASSWORD|PGPASSWORD|MONGO_URI|REDIS_URL|REDIS_PASSWORD)\\s*[=:]"
    - "(?i)\\$\\{?(DATABASE_URL|DB_PASSWORD|DB_PASS|MYSQL_PASSWORD|MYSQL_ROOT_PASSWORD|POSTGRES_PASSWORD|PGPASSWORD|MONGO_URI|REDIS_URL|REDIS_PASSWORD)\\}?"
    - "(?i)(mongodb|postgres|mysql|mariadb|redis|amqp)://\\w+:[^@\\s]+@"
    - "(?i)(connection[_-]?string|conn[_-]?str|dsn)\\s*[=:]\\s*[\"'][^\"']*password[^\"']*[\"']"
    - "(?i)(cat|read|open|get)\\s+.{0,20}\\.pgpass"
    - "(?i)(cat|read|open|get)\\s+.{0,20}\\.my\\.cnf"
    - "(?i)(steal|extract|exfiltrate|harvest|grab|dump)\\s+.{0,20}(database|db|sql|mongo|redis)\\s*(credential|password|secret|connection)"
false_positive_notes: >
  Database management skills may configure connection parameters.
  Verify whether the skill sets up new connections vs. extracting
  credentials from existing configurations.
remediation: >
  Remove hardcoded database credentials. Use environment-based
  secret injection, credential managers, or IAM-based database
  authentication instead of reading credential files directly.
references:
  - https://cwe.mitre.org/data/definitions/798.html
  - https://attack.mitre.org/techniques/T1552/001/
